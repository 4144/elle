#!/usr/bin/env python3

import os
import subprocess
import sys
import platform

template = ""
if platform.system() == "Darwin":
  template = '''\
import os, sys
sys.path.insert(
    0,
    os.path.abspath(
        os.path.join(os.path.dirname(__file__), '../source/drake/src')
    )
)

import drake
import drake.cxx
import drake.cxx.boost

cxx_toolkit = drake.cxx.GccToolkit(compiler="g++-4.7")
cxx_config = drake.cxx.Config()

cxx_config.flag('-fPIC')
cxx_config.flag('-Wall')
cxx_config.flag('-W')
cxx_config.flag('-m64')
cxx_config.enable_debug_symbols()
cxx_config.enable_optimization(False)
boost = drake.cxx.boost.Boost(prefix='/opt/local')

drake.run('../%s', cxx_toolkit, cxx_config, boost = boost)
'''
else:
  template = """\
import os, sys
sys.path.insert(
    0,
    os.path.abspath(
        os.path.join(os.path.dirname(__file__), '../source/drake/src')
    )
)

import drake
import drake.cxx
import drake.cxx.boost

cxx_toolkit = drake.cxx.GccToolkit()
cxx_config = drake.cxx.Config()

cxx_config.flag('-fPIC')
cxx_config.flag('-Wall')
cxx_config.flag('-W')
cxx_config.flag('-m64')
cxx_config.enable_debug_symbols()
cxx_config.enable_optimization(False)

import drake.valgrind
valgrind = drake.valgrind.Valgrind()

boost = drake.cxx.boost.Boost(prefix='%%s/local' %% os.environ['HOME'])

drake.run('../%s', cxx_toolkit, cxx_config, boost = boost, valgrind = valgrind)
"""


arch, osyst, compiler = os.environ['BUILDFARM_NAME'].split('-')

with open('%s/drake' % os.environ['DIR_BUILD'], 'w') as drake:
  print(template % os.environ['DIR_SOURCE'], file = drake)
