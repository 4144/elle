#!/usr/bin/env python3

import os
import os.path
import subprocess
import sys

arch, osyst, compiler = os.environ['BUILDFARM_NAME'].split('-')

command = ['python3', 'drake', '-j', os.environ['JOBS'], '//build']
cwd = os.getcwd()
dir_build, dir_install, dir_source = (
  os.environ['DIR_%s' % name] for name in ('BUILD', 'INSTALL', 'SOURCE'))

if osyst == 'linux_debian_squeeze':
  name = '%s-x86_64_linux-Debian-squeeze_gcc4' % os.environ['PROJECT']
  subprocess.check_call([
      'run-in-docker',
      '--image=infinit:wheezy-build',
      '--directory=%s' % dir_build,
      '--'] + command)
else:
  os.chdir('%s' % os.environ['DIR_BUILD'])
  if subprocess.call(command) != 0:
    exit(1)
