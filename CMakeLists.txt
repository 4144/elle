PROJECT(Infinit C CXX)

CMAKE_MINIMUM_REQUIRED(VERSION 2.6)

FIND_PACKAGE(Qt4 4.5 REQUIRED QtCore QtNetwork)
FIND_PACKAGE(OpenSSL REQUIRED)

INCLUDE_DIRECTORIES(. ${QT_INCLUDES} ${OPENSSL_INCLUDE_DIR})

MESSAGE("UNIX: ${UNIX}")
MESSAGE("WIN32: ${WIN32}")
MESSAGE("CMAKE_SYSTEM: ${CMAKE_SYSTEM}")
MESSAGE("CMAKE_HOST_SYSTEM: ${CMAKE_HOST_SYSTEM}")

#
# GNU CXXFLAGS
# XXX switch from -std=gnu++0x to -std=c++0x
#
IF(CMAKE_COMPILER_IS_GNUCXX)
  SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Wall -Wextra -std=gnu++0x -Wcast-align -Wold-style-cast -Wno-empty-body")
ENDIF()

#
# MSVC CXXFLAGS
#
IF(MSVC)
  SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} /Wall")
ENDIF()

#
# for FUSE
#
ADD_DEFINITIONS(-D_LARGE_FILE -D_FILE_OFFSET_BITS=64 -DWINVER=0x0600)

ADD_SUBDIRECTORY(comet)
ADD_SUBDIRECTORY(elle)
ADD_SUBDIRECTORY(nucleus)
ADD_SUBDIRECTORY(etoile)
ADD_SUBDIRECTORY(agent)
ADD_SUBDIRECTORY(lune)

IF(${UNIX})
  ADD_SUBDIRECTORY(pig)
ENDIF()

IF(${WIN32})
  ADD_SUBDIRECTORY(iig)
ENDIF()

ADD_SUBDIRECTORY(hole)
ADD_SUBDIRECTORY(applications)

# just to make files appears on qtcreator
FILE(GLOB_RECURSE HEADERS *.hh *.hxx)

ADD_LIBRARY(infinit
  Infinit.cc
  ${HEADERS}
)

ADD_EXECUTABLE(Infinit
  _infinit.cc
)

TARGET_LINK_LIBRARIES(Infinit infinit etoile nucleus lune agent hole)

IF(${UNIX})
  TARGET_LINK_LIBRARIES(Infinit pig)
ENDIF()

IF(${WIN32})
  TARGET_LINK_LIBRARIES(Infinit iig)
ENDIF()

TARGET_LINK_LIBRARIES(Infinit ${QT_QTNETWORK_LIBRARIES}
                              ${QT_QTCORE_LIBRARIES})

# XXX
ADD_EXECUTABLE(XXX
  XXX/Porcupine.cc
  XXX/XXX.cc
)

TARGET_LINK_LIBRARIES(XXX infinit elle nucleus lune infinit
                              ${QT_QTNETWORK_LIBRARIES}
                              ${QT_QTCORE_LIBRARIES})
